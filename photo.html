<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Base64 Image from UUID</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>

<body class="bg-gray-100 p-10">

    <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
        <h1 class="text-xl font-semibold mb-4">Fetch Image by UUID</h1>

        <!-- Input for User UUID -->
        <label for="userId" class="block text-sm font-semibold mb-2">Enter User UUID</label>
        <input type="text" id="userId" class="w-full p-2 border rounded mb-4"
            placeholder="e.g. 69c4ffbf-ab82-4cd2-a230-1f145a04c6db">

        <!-- Button to fetch the image -->
        <button id="fetchImageBtn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
            Fetch Image
        </button>

        <!-- Image Preview -->
        <div id="imageContainer" class="mt-6">
            <h2 class="text-lg font-semibold mb-2">Image Preview:</h2>
            <img id="imagePreview" class="max-w-full border p-2 rounded" alt="Image will appear here" />
        </div>

        <!-- Error Message -->
        <p id="errorMessage" class="text-red-500 text-sm mt-2 hidden">Error: User not found or photo not available.</p>
    </div>

    <script>
        // Initialize Supabase client
        const supabase = window.supabase.createClient(
            'https://pxvxcbjzlzzggkkiehlv.supabase.co', // replace with your Supabase project URL
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4dnhjYmp6bHp6Z2dra2llaGx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1NDA4OTEsImV4cCI6MjA2OTExNjg5MX0.FDCKKYv5eTpoOtv3nTbptBHl2GfvAxYyiWpdNPvkktE' // replace with your Supabase anon public key
        );

        // Function to fetch photo by UUID
        async function fetchPhotoByUUID(uuid) {
            try {
                // Query Supabase to get the photo field for the given UUID
                const { data, error } = await supabase
                    .from('users')
                    .select('photo')
                    .eq('id', uuid)
                    .single(); // We use .single() because UUID should be unique

                if (error || !data) {
                    $('#imagePreview').hide();
                    $('#errorMessage').removeClass('hidden');
                    return;
                }

                // If a photo is found, set the image source to base64 data
                $('#errorMessage').addClass('hidden');
                $('#imagePreview').show();
                $('#imagePreview').attr('src', data.photo);
            } catch (err) {
                $('#imagePreview').hide();
                $('#errorMessage').removeClass('hidden');
            }
        }

        // Event listener for fetching the image
        $('#fetchImageBtn').on('click', function () {
            const uuid = $('#userId').val().trim();

            if (uuid) {
                fetchPhotoByUUID(uuid);
            } else {
                $('#imagePreview').hide();
                $('#errorMessage').removeClass('hidden').text('Please enter a valid UUID.');
            }
        });
    </script>

</body>

</html>